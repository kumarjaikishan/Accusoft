import{r as k,j as e,t as je,v as ve,c as Q,f as X,F as be,i as Ce,S as ye,T as _,w as Se,B as Y,M as $e,I as Ae,h as E,Q as N,x as F,y as we,z as oe,s as re,e as ce,g as le,G as ke,b as De,R as Ne,d as H,m as J,A as Ie,C as Me,D as Oe}from"./index-BdcM-fzq.js";import{a as q}from"./apiWrapper-C4pdXBos.js";import{V as Le}from"./index-CNnaJfhY.js";import{M as Te}from"./MenuItem-DSHU_IOj.js";import{H as de,R as ue,a as ze}from"./index-D7UmoBTw.js";const Pe=({totalpost:$,postperpage:y,changepageno:A,currentpage:g})=>{let I=[];const[b,c]=k.useState(5),[h,l]=k.useState(5),[S,C]=k.useState(0);for(let i=1;i<=Math.ceil($/y);i++)I.push(i);const m=I.map((i,t)=>{if(i<h+1&&i>S)return e.jsx("span",{onClick:()=>A(i),className:g==i?"pages active":"pages",children:i},t)}),o=()=>{l(h+b),C(S+b),h>=I.length-1&&(l(I.length),C(I.length-b))},u=()=>{l(h-b),C(S-b),S<=1&&(l(b),C(0))};return e.jsxs(e.Fragment,{children:[e.jsx(je,{title:"Previous 5 Pages",onClick:u}),m,e.jsx(ve,{title:"Next 5 Pages",onClick:o})]})},Ee=({modal:$,navigate:y,disable:A,setdisable:g,init:I,handler:b,inp:c,isupdate:h,sub:l,setmodal:S,setisupdate:C,setinp:m})=>{var f;const o=Q(n=>n.userexplist),u=X(),i=async n=>{let{ledger:j,date:a,amount:d,narration:p}=c;g(!0);const w="/api/updateexp",v="POST",D={_id:n,ledger:j,date:a,amount:d,narration:t(p)};await q({url:w,method:v,body:D,dispatch:u,successAction:U=>{N.success(U.message,{autoClose:1300}),u(F()),m(I),g(!1),C(!1),S(!1)},loaderAction:U=>u(E(U)),notsuccessAction:U=>{g(!1)},navigate:y})},t=n=>n.split(" ").map(d=>d.charAt(0).toUpperCase()+d.slice(1).toLowerCase()).join(" ");var r=document.querySelector(".modal");const x=function(n){n.target==r&&S(!1)};return e.jsx("div",{className:"modal",onClick:x,style:{display:$?"block":"none"},children:e.jsxs("div",{className:"box",children:[e.jsx("h1",{children:"Add Voucher"}),e.jsxs("span",{className:"wrapper",children:[e.jsxs(be,{className:"caps",sx:{width:"90%",mt:2,mb:2},children:[e.jsx(Ce,{id:"demo-simple-select-label",children:"Ledger"}),e.jsx(ye,{name:"ledger",labelId:"demo-simple-select-label",onChange:n=>b(n,"ledger"),value:c.ledger,id:"demo-simple-select",label:"Ledger",children:(f=o==null?void 0:o.ledgerlist)==null?void 0:f.map((n,j)=>e.jsx(Te,{sx:{textTransform:"capitalize"},value:n._id,children:n.ledger},j))})]}),e.jsx(_,{type:"date",label:"Date",value:c.date,onChange:n=>b(n,"date"),sx:{width:"90%",mt:2,mb:2}}),e.jsx(_,{sx:{width:"90%",mt:2,mb:2},id:"outlined-basic",label:"Amount",name:"amount",onKeyPress:n=>{/[0-9]/.test(n.key)||n.preventDefault()},type:"tel",value:c.amount,onChange:n=>b(n,"amount"),InputProps:{startAdornment:e.jsx(Se,{position:"start",children:"â‚¹"})},variant:"outlined"}),e.jsx(_,{multiline:!0,rows:2,sx:{width:"90%",mt:2,mb:2},id:"outlined-basic",label:"Narration",name:"narration",value:c.narration,type:"text",onChange:n=>b(n,"narration"),variant:"outlined"}),e.jsxs("div",{className:"btn",children:[h?e.jsx(Y,{disabled:A,onClick:()=>i(c._id),variant:"contained",startIcon:e.jsx($e,{}),children:"Update"}):e.jsx(Y,{disabled:A,onClick:l,variant:"contained",startIcon:e.jsx(Ae,{}),children:"Submit"}),e.jsx(Y,{onClick:()=>{S(!1),C(!1),m(I)},className:"muibtn outlined",title:"Cancel",variant:"outlined",startIcon:e.jsx(Le,{}),children:"Cancel"})]})]})]})})},Ye=({setmodal:$,setdisable:y,disable:A,navigate:g,isledupdate:I,setisledupdate:b})=>{var j;const c=X(),h=Q(a=>a.userexplist),[l,S]=k.useState(!1);k.useEffect(()=>{},[]);const C={ind:"",ledger:"",budget:""},[m,o]=k.useState(C),u=a=>{o({...m,ledger:a.target.value})},i=a=>{const d=a.target.value;isNaN(d)||o({...m,budget:d})},t=async()=>{if(!m.ledger)return N.warn("Ledger Can't be Blank",{autoClose:1300});if(!m.budget)return N.warn("Budget Can't be Blank",{autoClose:1300});const a="/api/addledger",d="POST",p={ledger:m.ledger,budget:parseFloat(m.budget)};y(!0),await q({url:a,method:d,body:p,dispatch:c,successAction:O=>{N.success(O.message,{autoClose:1300}),c(F()),o(C),y(!1)},loaderAction:O=>c(E(O)),navigate:g,notsuccessAction:O=>{N.warn(O.message,{autoClose:1800}),y(!1)}})},r=async()=>{if(!m.ledger)return N.warn("Ledger Can't be Blank",{autoClose:1300});if(!m.budget)return N.warn("Budget Can't be Blank",{autoClose:1300});const a=m.ind,d=m.ledger,p=parseFloat(m.budget),w=localStorage.getItem("token");try{y(!0);const v=await fetch("/api/updateledger",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`},body:JSON.stringify({ledger_id:a,newledger:d,newbudget:p})}),D=await v.json();if(!v.ok&&D.message==="jwt expired")return N.warn("Session expired. Please log in again.",{autoClose:1700}),g("/logout");v.ok&&v.status===200?(N.success(D.message,{autoClose:1300}),o(C),S(!1),c(F())):N.warn(D.message,{autoClose:2300}),y(!1)}catch(v){console.log(v),y(!1)}},x=async a=>{re({title:"Are you sure?",text:"Once deleted, you will not be able to recover this Data!",icon:"warning",buttons:!0,dangerMode:!0}).then(async d=>{if(d){const p="/api//deleteledger",w="POST",v={ledgerid:a};y(!0),await q({url:p,method:w,body:v,dispatch:c,successAction:z=>{N.success(z.message,{autoClose:1300}),c(F()),y(!1)},loaderAction:z=>c(E(z)),navigate:g,notsuccessAction:z=>{N.warn(z.message,{autoClose:1800}),y(!1)}})}})},f=(a,d,p)=>{o({ind:a,ledger:d,budget:p}),S(!0)},n=a=>{a.target.classList.contains("ledpage")&&b(!1)};return e.jsx("div",{className:"ledpage",onClick:n,style:{display:I?"block":"none"},children:e.jsxs("div",{className:"box",children:[e.jsxs("h2",{children:["Hi, ",(j=h==null?void 0:h.user)==null?void 0:j.name]}),e.jsxs("span",{className:"ledwrapper",children:[e.jsxs("div",{className:"cont",children:[e.jsx(_,{label:"Enter Ledger",size:"small",variant:"outlined",style:{width:"250px"},value:m.ledger,onChange:u,className:"inpe"}),e.jsx(_,{label:"Budget",size:"small",variant:"outlined",value:m.budget,style:{width:"170px"},onChange:i,className:"inpe",type:"number"}),l?e.jsx(Y,{size:"small",className:"btne",disabled:A,title:"Add",onClick:r,startIcon:e.jsx(we,{}),variant:"contained",children:"Update"}):e.jsx(Y,{size:"small",className:"btne",disabled:A,title:"Add",onClick:t,startIcon:e.jsx(oe,{}),variant:"contained",children:"Add"})]}),e.jsx("div",{className:"mater",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ledger"}),e.jsx("th",{children:"Budget"}),e.jsx("th",{children:"Edit"}),e.jsx("th",{children:"Delete"})]})}),e.jsx("tbody",{children:h.ledgerlist&&h.ledgerlist.map((a,d)=>e.jsxs("tr",{children:[e.jsx("td",{children:a.ledger}),e.jsx("td",{children:a.budget}),e.jsx("td",{children:e.jsx(de,{className:"editicon ico",title:"Edit",onClick:()=>f(a._id,a.ledger,a.budget)})}),e.jsx("td",{children:e.jsx(ue,{className:"deleteicon ico",title:"Delete",onClick:()=>x(a._id)})})]},d))})]})})]})]})})};var he={exports:{}};(function($,y){(function(A,g){$.exports=g()})(ce,function(){var A="minute",g=/[+-]\d\d(?::?\d\d)?/g,I=/([+-]|\d\d)/g;return function(b,c,h){var l=c.prototype;h.utc=function(t){var r={date:t,utc:!0,args:arguments};return new c(r)},l.utc=function(t){var r=h(this.toDate(),{locale:this.$L,utc:!0});return t?r.add(this.utcOffset(),A):r},l.local=function(){return h(this.toDate(),{locale:this.$L,utc:!1})};var S=l.parse;l.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),S.call(this,t)};var C=l.init;l.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else C.call(this)};var m=l.utcOffset;l.utcOffset=function(t,r){var x=this.$utils().u;if(x(t))return this.$u?0:x(this.$offset)?m.call(this):this.$offset;if(typeof t=="string"&&(t=function(a){a===void 0&&(a="");var d=a.match(g);if(!d)return null;var p=(""+d[0]).match(I)||["-",0,0],w=p[0],v=60*+p[1]+ +p[2];return v===0?0:w==="+"?v:-v}(t),t===null))return this;var f=Math.abs(t)<=16?60*t:t;if(f===0)return this.utc(r);var n=this.clone();if(r)return n.$offset=f,n.$u=!1,n;var j=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();return(n=this.local().add(f+j,A)).$offset=f,n.$x.$localOffset=j,n};var o=l.format;l.format=function(t){var r=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return o.call(this,r)},l.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*t},l.isUTC=function(){return!!this.$u},l.toISOString=function(){return this.toDate().toISOString()},l.toString=function(){return this.toDate().toUTCString()};var u=l.toDate;l.toDate=function(t){return t==="s"&&this.$offset?h(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():u.call(this)};var i=l.diff;l.diff=function(t,r,x){if(t&&this.$u===t.$u)return i.call(this,t,r,x);var f=this.local(),n=h(t).local();return i.call(f,n,r,x)}}})})(he);var Ue=he.exports;const Be=le(Ue);var me={exports:{}};(function($,y){(function(A,g){$.exports=g()})(ce,function(){var A={year:0,month:1,day:2,hour:3,minute:4,second:5},g={};return function(I,b,c){var h,l=function(o,u,i){i===void 0&&(i={});var t=new Date(o),r=function(x,f){f===void 0&&(f={});var n=f.timeZoneName||"short",j=x+"|"+n,a=g[j];return a||(a=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:x,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:n}),g[j]=a),a}(u,i);return r.formatToParts(t)},S=function(o,u){for(var i=l(o,u),t=[],r=0;r<i.length;r+=1){var x=i[r],f=x.type,n=x.value,j=A[f];j>=0&&(t[j]=parseInt(n,10))}var a=t[3],d=a===24?0:a,p=t[0]+"-"+t[1]+"-"+t[2]+" "+d+":"+t[4]+":"+t[5]+":000",w=+o;return(c.utc(p).valueOf()-(w-=w%1e3))/6e4},C=b.prototype;C.tz=function(o,u){o===void 0&&(o=h);var i,t=this.utcOffset(),r=this.toDate(),x=r.toLocaleString("en-US",{timeZone:o}),f=Math.round((r-new Date(x))/1e3/60),n=15*-Math.round(r.getTimezoneOffset()/15)-f;if(!Number(n))i=this.utcOffset(0,u);else if(i=c(x,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(n,!0),u){var j=i.utcOffset();i=i.add(t-j,"minute")}return i.$x.$timezone=o,i},C.offsetName=function(o){var u=this.$x.$timezone||c.tz.guess(),i=l(this.valueOf(),u,{timeZoneName:o}).find(function(t){return t.type.toLowerCase()==="timezonename"});return i&&i.value};var m=C.startOf;C.startOf=function(o,u){if(!this.$x||!this.$x.$timezone)return m.call(this,o,u);var i=c(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return m.call(i,o,u).tz(this.$x.$timezone,!0)},c.tz=function(o,u,i){var t=i&&u,r=i||u||h,x=S(+c(),r);if(typeof o!="string")return c(o).tz(r);var f=function(d,p,w){var v=d-60*p*1e3,D=S(v,w);if(p===D)return[v,p];var O=S(v-=60*(D-p)*1e3,w);return D===O?[v,D]:[d-60*Math.min(D,O)*1e3,Math.max(D,O)]}(c.utc(o,t).valueOf(),x,r),n=f[0],j=f[1],a=c(n).utcOffset(j);return a.$x.$timezone=r,a},c.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},c.tz.setDefault=function(o){h=o}}})})(me);var Fe=me.exports;const Re=le(Fe);function _e($){return ke({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"},child:[]}]})($)}H.extend(Be);H.extend(Re);const Xe=()=>{var se;const $=X();let y=De();const A=Q(s=>s.userexplist),[g,I]=k.useState(""),[b,c]=k.useState(""),h=Ne.useRef(!1),[l,S]=k.useState(!1),[C,m]=k.useState(!1),[o,u]=k.useState(!1),[i,t]=k.useState(1),[r,x]=k.useState(10),[f,n]=k.useState(!1),[j,a]=k.useState(!1),d={_id:"",ledger:"",date:H().format("YYYY-MM-DD"),amount:"",narration:""},[p,w]=k.useState(d);k.useEffect(()=>{$(E(!1))},[]),k.useEffect(()=>{a(!0);const s=setTimeout(()=>{c(g.toLowerCase()),a(!1)},1300);return()=>clearTimeout(s)},[g]);const v=(s,M)=>{w({...p,[M]:s.target.value})},D=s=>s.split(" ").map(L=>L.charAt(0).toUpperCase()+L.slice(1).toLowerCase()).join(" "),O=async()=>{let{ledger:s,date:M,amount:L,narration:B}=p;if(!s||!M||!L||!B){const T=document.querySelector(".box");return T.classList.add("shake"),setTimeout(()=>T.classList.remove("shake"),420),$(E(!1)),N.warn("Kindly Fill all Fields",{autoClose:1700})}const R="/api/addexpense",ne="POST",ae={ledger:s,date:M,amount:L,narration:D(B)};A.ledgerlist.find(T=>T._id===s).ledger,D(B),await q({url:R,method:ne,body:ae,dispatch:$,successAction:T=>{N.success(T.message,{autoClose:1300}),$(F()),n(!1),w(d)},loaderAction:T=>$(E(T)),notsuccessAction:T=>N.warn(T.message,{autoClose:1800}),navigate:y})},K=s=>{w({_id:s._id,ledger:s.ledger._id,date:H(s.date).format("YYYY-MM-DD"),amount:s.amount,narration:s.narration}),S(!0),n(!0)},z=s=>{h.current=!0,ee([s])},U=()=>{const s=document.querySelectorAll("#tablecontent input:checked"),M=Array.from(s).map(L=>L.id);ee(M)},ee=async s=>{if(s.length<1)return N.warn("Kindly Select Atlest 1 Entry",{autoClose:1700});re({title:"Are you sure?",text:"Once deleted, you will not be able to recover this Data!",icon:"warning",buttons:!0,dangerMode:!0}).then(async M=>{M&&await q({url:"/api/delmany",method:"POST",body:{id:s},dispatch:$,successAction:W=>{N.success(W.message,{autoClose:1300}),$(F()),document.querySelectorAll("#tablecontent input:checked").forEach(ie=>ie.checked=!1),setTimeout(()=>{h.current=!1},100),V()},loaderAction:W=>$(E(W)),navigate:y})})},fe=()=>{const s=document.querySelector("#allcheck");document.querySelectorAll("#tablecontent input").forEach(L=>L.checked=s.checked),V()},pe=s=>{x(Number(s.target.value)),t(1)},ge=s=>{t(s)},V=()=>{const s=document.querySelectorAll("#tablecontent input"),M=document.querySelectorAll("#tablecontent div");s.forEach((L,B)=>{const R=M[B];L.checked?R.classList.add("checked"):R.classList.remove("checked")})},P=((se=A==null?void 0:A.explist)==null?void 0:se.filter(s=>b===""||s.narration.toLowerCase().includes(b)||s.ledger.ledger.toLowerCase().includes(b)||s.amount.toString().includes(b)))||[];let Z=i*r;const G=Z-r,te=P.slice(G,Z),[He,qe]=k.useState("ASC"),xe={visible:{transition:{delayChildren:.1}}};return e.jsx(e.Fragment,{children:e.jsxs(J.div,{initial:{opacity:0,x:"100%"},animate:{opacity:1,x:0},exit:{opacity:0,x:"-100%"},transition:{duration:.2,ease:"easeInOut"},className:f||o?"exp ismodal":"exp",children:[e.jsxs("div",{className:"add",children:[e.jsx(Y,{title:"Add Expense",onClick:()=>n(!0),startIcon:e.jsx(oe,{}),variant:"contained",children:"Add Expense"}),e.jsx(Y,{title:"Ledger",onClick:()=>u(!0),startIcon:e.jsx(Ie,{}),variant:"outlined",children:"Ledger"})]}),e.jsxs("div",{className:"head",children:[e.jsx("span",{children:"Expense List "}),e.jsxs("span",{children:["Record :"," ",e.jsxs("select",{title:"Items Per Page",value:r,onChange:pe,children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"}),e.jsx("option",{value:"500",children:"500"})]})]}),e.jsxs("span",{children:[e.jsx("input",{type:"text",title:"Search",onChange:s=>I(s.target.value),value:g,placeholder:"Type to search..."}),j?e.jsxs("span",{title:"Searching",children:["  ",e.jsx(_e,{className:"spin"})," "]}):e.jsxs("span",{title:"clear",onClick:()=>I(""),children:["   ",e.jsx(Me,{})]})]})]}),e.jsxs("div",{className:"table",children:[e.jsxs("div",{className:"header",children:[e.jsx("span",{children:"S.no"}),e.jsx("span",{children:"Ledger"}),e.jsx("span",{children:"Amt. "}),e.jsx("span",{children:"Narration"}),e.jsx("span",{children:"Date "}),e.jsx("span",{children:"Action"}),e.jsx("span",{children:e.jsx("input",{type:"checkbox",onClick:fe,id:"allcheck"})})]}),e.jsxs(J.div,{variants:xe,initial:"hidden",animate:"visible",className:"body",id:"tablecontent",children:[P.length<1&&e.jsx("div",{style:{width:"100%",display:"flex",justifyContent:"center",margin:"8px 0"},children:e.jsx("b",{children:"No Expense Added"})}),e.jsxs(Oe,{children:[te.map((s,M)=>e.jsxs(J.div,{exit:h.current?{opacity:1,x:"-102%",transition:{duration:.6}}:{},children:[e.jsx("span",{children:G+M+1}),e.jsx("span",{className:"caps",children:s.ledger.ledger}),e.jsx("span",{children:s.amount}),e.jsx("span",{children:s.narration}),e.jsx("span",{children:H(s.date).format("DD MMM, YYYY")}),e.jsxs("span",{children:[e.jsx(de,{title:"Edit",onClick:()=>K(s),className:"editicon ico"}),e.jsx(ue,{title:"Delete",onClick:()=>z(s._id),className:"deleteicon ico"})]}),e.jsx("span",{children:e.jsx("input",{type:"checkbox",title:"select",onClick:V,id:s._id})})]},s._id)),e.jsxs("div",{id:"foot",children:[e.jsx("span",{}),e.jsx("span",{style:{fontWeight:700},children:"Total"}),e.jsx("span",{style:{fontWeight:700},id:"totalhere",children:te.reduce((s,M)=>s+M.amount,0)}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{colSpan:"1",id:"alldelete",title:"Delete Selected Item",children:e.jsx(ze,{onClick:U})}),e.jsx("span",{})]})]})]})]}),e.jsxs("div",{className:"foot",children:[e.jsxs("span",{children:["Showing Result From ",P.length===0?0:G+1," To"," ",Z>=P.length?P.length:Z," of"," ",P.length," Results"]}),e.jsxs("span",{children:["Pages :",e.jsx(Pe,{currentpage:i,changepageno:ge,totalpost:P.length,postperpage:r})]})]}),e.jsx(Ee,{init:d,setdisable:m,disable:C,setinp:w,setisupdate:S,setmodal:n,sub:O,modal:f,handler:v,inp:p,isupdate:l,navigate:y}),e.jsx(Ye,{navigate:y,setmodal:n,setdisable:m,disable:C,setisledupdate:u,isledupdate:o})]})})};export{Xe as default};
