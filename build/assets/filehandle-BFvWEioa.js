import{r as c,j as e,B as x,M as S,I as z,T as R,Q as i,s as U}from"./index-B9NyKQW9.js";import{R as M,H as ae}from"./index-nTKs3oeZ.js";const re=()=>{const[h,J]=c.useState([]),[ne,A]=c.useState([]),[w,k]=c.useState(""),[W,g]=c.useState(!1),[T,v]=c.useState(""),[N,L]=c.useState(null),[$,E]=c.useState(""),[O,D]=c.useState(!1),[P,b]=c.useState(!1),[F,q]=c.useState("");c.useEffect(()=>{},[]);const _=t=>{const a=Array.from(t.target.files);J(a)},G=t=>{k(t.target.value)},H=t=>{v(t.target.value)},K=t=>{E(t.target.value)},p=async()=>{const t=localStorage.getItem("token"),s=await(await fetch("/api/getFilejobs",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}})).json();L(s==null?void 0:s.filejobs)},Q=async t=>{t.preventDefault();const a=w.split(",").map(n=>n.trim()),s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,o=a.filter(n=>!s.test(n));if(o.length>0)return i.warn(`Invalid email(s): ${o.join(", ")}`,{autoClose:1900});const r=i.loading("Please wait..."),l=w.split(",").map(n=>n.trim());try{D(!0);const n=localStorage.getItem("token"),y=h.map(m=>{const j=m.name.split(".").pop();return{filename:`${m.name.replace(/\.[^/.]+$/,"")}flname${Date.now()}.${j}`,contentType:m.type}}),u=await fetch("/api/createFileurl",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({files:y})});if(!u.ok)throw new Error("Error occurred while creating presigned URLs");const{urls:d}=await u.json();await Promise.all(d.map(async(m,j)=>{const C=h[j];if(!(await fetch(m.url,{method:"PUT",headers:{"Content-Type":C.type},body:C})).ok)throw new Error(`Error uploading file: ${C.name}`)}));const I=await fetch("/api/createFileJob",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({emailRecipients:l,days:T,messagee:$,files:d.map((m,j)=>({filename:y[j].filename,url:m.url.split("?")[0]}))})});if(D(!1),!I.ok)throw new Error("Error occurred while creating the file job");const{message:se}=await I.json();p(),f(),i.update(r,{render:se,type:"success",isLoading:!1,autoClose:1300})}catch(n){D(!1),console.error("Failed to create file job:",n),i.update(r,{render:n.message,type:"warning",isLoading:!1,autoClose:2600})}},f=()=>{g(!1),k(""),v(""),E(""),J([]),A([]),b(!1)},Y=async t=>{U({title:"Are you sure?",text:"Once deleted, you will not be able to recover this Data!",icon:"warning",buttons:!0,dangerMode:!0}).then(async a=>{if(a)try{const s=localStorage.getItem("token"),o=await fetch("/api/deleteFileJob",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({jobid:t})}),r=await o.json();if(!o.ok)return i.warn(r.message,{autoClose:1900});p(),f(),i.success(r.message,{autoClose:1500})}catch(s){console.log(s)}})},V=t=>{q(t._id),k(t.emailRecipients),v(t.days),E(t.message),b(!0),g(!0),A(t.fileUrls)},X=async()=>{const t=localStorage.getItem("token"),a="/api/";try{if(h.length){const s=h.map(l=>{const n=l.name.split(".").pop();return{filename:`${l.name.replace(/\.[^/.]+$/,"")}flname${Date.now()}.${n}`,contentType:l.type}}),o=await fetch(`${a}createFileurl`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({files:s})});if(!o.ok)throw new Error("Error occurred while creating presigned URLs");const{urls:r}=await o.json();await Promise.all(r.map((l,n)=>fetch(l.url,{method:"PUT",headers:{"Content-Type":h[n].type},body:h[n]}))),await B(r.map((l,n)=>({filename:s[n].filename,url:l.url.split("?")[0]})))}else await B();p(),b(!1),f(),i.success("Update successful",{autoClose:1500})}catch(s){b(!1),console.error(s),i.error(s.message,{autoClose:2300})}},B=async(t=[])=>{const a=localStorage.getItem("token"),s=await fetch("/api/updateJob",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({jobid:F,emails:w,days:T,messagee:$,files:t})}),o=await s.json();if(!s.ok)throw new Error(o.message)},Z=async()=>{try{const t=localStorage.getItem("token"),a=await fetch("/api/updateTimerall",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({})}),s=await a.json();if(!a.ok)return i.warn(s.message,{autoClose:1900});p(),i.success(s.message,{autoClose:1500})}catch(t){console.log(t),i.error(t.message,{autoClose:2300})}},ee=async t=>{try{const a=localStorage.getItem("token"),s=await fetch("/api/updateoneTimer",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({jobid:t})}),o=await s.json();if(!s.ok)return i.warn(o.message,{autoClose:1900});p(),i.success(o.message,{autoClose:1500})}catch(a){console.log(a),i.error(a.message,{autoClose:2300})}},te=async(t,a)=>{U({title:"Are you sure?",text:"Once deleted, you will not be able to recover this Data!",icon:"warning",buttons:!0,dangerMode:!0}).then(async s=>{if(s)try{const o=localStorage.getItem("token"),r=await fetch("/api/deleteasset",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({url:t.url,index:a,jobid:F})}),l=await r.json();if(g(!1),f(),!r.ok)return i.warn(l.message,{autoClose:1900});p(),i.success(l.message,{autoClose:1500})}catch(o){f(),g(!1),console.log(o),i.error(o.message,{autoClose:2300})}})};return e.jsxs("div",{className:"filehandle",children:[e.jsxs("div",{style:{margin:"5px 0px",display:"flex",justifyContent:"center"},children:[e.jsx(x,{className:"muibtn",sx:{mr:5},onClick:()=>g(!0),disabled:O,variant:"contained",startIcon:e.jsx(S,{}),children:"Create New"}),e.jsx(x,{className:"muibtn outlined",onClick:()=>Z(),variant:"outlined",startIcon:e.jsx(z,{}),children:"update timer"})]}),e.jsx("div",{className:"table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{className:"header",children:[e.jsx("th",{children:"S.no"}),e.jsx("th",{children:"Days"}),e.jsx("th",{children:"Expiry"}),e.jsx("th",{children:"Remaining"}),e.jsx("th",{children:"Files"}),e.jsx("th",{children:"Emails"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{className:"body",children:N==null?void 0:N.map((t,a)=>{var n,y;const s=new Date(t.expiryDate),r=s-new Date,l=Math.ceil(r/(1e3*60*60*24));return e.jsxs("tr",{className:"bodyrow",children:[e.jsx("td",{children:a+1}),e.jsx("td",{children:t.days}),e.jsx("td",{children:s.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}),e.jsxs("td",{children:[l," days"]}),e.jsx("td",{children:(n=t.fileUrls)==null?void 0:n.map((u,d)=>e.jsxs("div",{className:"teste",children:[e.jsxs("span",{children:[d+1,". ",u.filename.split("flname")[0],".",u.filename.split("flname")[1].split(".")[1]]},d),e.jsx("span",{children:e.jsx(M,{title:`Delete ${u.filename.split("flname")[0]}`,onClick:()=>te(u,d),className:"deleteicon ico"})})]},d))}),e.jsx("td",{children:e.jsx("ul",{children:(y=t.emailRecipients)==null?void 0:y.map((u,d)=>e.jsxs("li",{children:[d+1,". ",u]},d))})}),e.jsxs("td",{children:[e.jsx(ae,{title:"Edit",onClick:()=>V(t),className:"editicon ico"}),e.jsx(S,{title:"Refresh",onClick:()=>ee(t._id),className:"refresh ico"}),e.jsx(M,{title:"Delete",onClick:()=>Y(t._id),className:"deleteicon ico"})]})]},a)})})]})}),W&&e.jsx("div",{className:"modale",children:e.jsxs("form",{onSubmit:Q,children:[e.jsx("h2",{children:"Create File Job"}),e.jsxs("div",{children:[P?e.jsx("label",{children:"Add New Files:"}):e.jsx("label",{children:"Upload Files:"}),e.jsx("br",{}),e.jsx("input",{type:"file",multiple:!0,onChange:_})]}),e.jsx("div",{children:e.jsx(R,{fullWidth:!0,id:"outlined-basic",label:"Email Recipients",name:"email",value:w,onChange:G,helperText:"Add multiple Emails with comma-separated",size:"small",variant:"outlined"})}),e.jsx("div",{children:e.jsx(R,{fullWidth:!0,id:"outlined-basic",label:"Days",name:"days",onKeyPress:t=>{/[0-9]/.test(t.key)||t.preventDefault()},type:"tel",value:T,onChange:H,helperText:"Number of days you want",size:"small",variant:"outlined"})}),e.jsx("div",{children:e.jsx(R,{fullWidth:!0,id:"outlined-basic",label:"Message",name:"message",multiline:!0,rows:4,value:$,onChange:K,helperText:"Message For Your relatives",size:"small",variant:"outlined"})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-around"},children:[P?e.jsx(x,{className:"muibtn",disabled:O,onClick:X,variant:"contained",startIcon:e.jsx(S,{}),children:"Update"}):e.jsx(x,{className:"muibtn",disabled:O,type:"submit",variant:"contained",startIcon:e.jsx(S,{}),children:"Create Job"}),e.jsx(x,{className:"muibtn outlined",onClick:f,variant:"outlined",startIcon:e.jsx(z,{}),children:"Cancel"})]})]})})]})};export{re as default};
