import{c as L,g as J,u as q,a as H,b as K,r as f,s as P,d as v,j as e,m as Q,F as T,I as E,S as C,M as h}from"./index-B6xWl_K2.js";var Y={exports:{}};(function(S,n){(function(u,r){S.exports=r()})(L,function(){return function(u,r){r.prototype.isSameOrAfter=function(d,i){return this.isSame(d,i)||this.isAfter(d,i)}}})})(Y);var W=Y.exports;const X=J(W);var k={exports:{}};(function(S,n){(function(u,r){S.exports=r()})(L,function(){return function(u,r){r.prototype.isSameOrBefore=function(d,i){return this.isSame(d,i)||this.isBefore(d,i)}}})})(k);var Z=k.exports;const ee=J(Z);v.extend(X);v.extend(ee);const se=()=>{var M,w;const S=q(),n=H(t=>t.userexplist||{}),u=K(),[r,d]=f.useState(!0),i=new Date,D=localStorage.getItem("month"),I=localStorage.getItem("year"),[l,z]=f.useState({date:`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`,month:D!==null?parseInt(D,10):i.getMonth(),year:I!==null?parseInt(I,10):i.getFullYear()}),_=()=>{let t=!r;d(t),localStorage.setItem("showbudget",JSON.stringify(t))};f.useEffect(()=>{let t=localStorage.getItem("showbudget");t&&d(!!JSON.parse(t))},[]);const[m,R]=f.useState({});f.useEffect(()=>{V(),S(P(!1)),localStorage.setItem("month",String(l.month)),localStorage.setItem("year",String(l.year))},[l.month,l.year,n]);const g=t=>typeof t=="number"?t.toLocaleString(void 0,{maximumFractionDigits:2}):t,V=()=>{const t={};let s=0,a=0;(Array.isArray(n==null?void 0:n.ledgerlist)?n.ledgerlist:[]).forEach(o=>{const p=Number(o.budget||0)||0;a+=p,t[o._id]={ledger:o.ledger,budget:p,totalSum:0}});const b=String(parseInt(l.month,10)+1).padStart(2,"0"),x=v(`${l.year}-${b}-01`),y=x.endOf("month");(Array.isArray(n==null?void 0:n.explist)?n.explist:[]).forEach(o=>{const p=o!=null&&o.ledger&&typeof o.ledger=="object"?o.ledger._id:(o==null?void 0:o.ledger)||null,$=parseFloat(o.amount),B=v(o.date);p&&!isNaN($)&&B.isValid()&&B.isSameOrAfter(x)&&B.isSameOrBefore(y)&&t[p]&&(s+=$,t[p].totalSum+=$)}),t.Total={ledger:"Total",budget:a,totalSum:s},R(t)},G=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],A=t=>{const s=t.target.name;let a=t.target.value;(s==="month"||s==="year")&&(a=parseInt(a,10)),z(c=>({...c,[s]:a}))},U=t=>{if(t==="Total"){u(`/datanalysis/ledgerDetail/all?&ledgerName=All Ledger&month=${l.month}&year=${l.year}`);return}const s=((n==null?void 0:n.ledgerlist)||[]).find(a=>a._id===t);u(s?`/datanalysis/ledgerDetail/${t}?&ledgerName=${encodeURIComponent(s.ledger)}&month=${l.month}&year=${l.year}`:`/datanalysis/ledgerDetail/all?&ledgerName=All Ledger&month=${l.month}&year=${l.year}`)},F=f.useMemo(()=>{const t=Object.entries(m||{}),s=t.filter(([c])=>c!=="Total"),a=t.find(([c])=>c==="Total");return a?[...s,a]:s},[m]),j=((M=m==null?void 0:m.Total)==null?void 0:M.totalSum)||0,N=((w=m==null?void 0:m.Total)==null?void 0:w.budget)||0;return e.jsx(e.Fragment,{children:e.jsxs(Q.div,{initial:{opacity:0,x:"100%"},animate:{opacity:1,x:0},exit:{opacity:0,x:"-100%"},transition:{duration:.2,ease:"easeInOut"},className:"datanalysis",children:[e.jsxs("div",{className:"cont",children:[e.jsx("span",{children:e.jsxs(T,{size:"small",className:" select caps",children:[e.jsx(E,{id:"month-select-label",children:"Month"}),e.jsx(C,{name:"month",size:"small",labelId:"month-select-label",onChange:A,value:l.month,id:"month-select",label:"Month",children:G.map((t,s)=>e.jsx(h,{sx:{textTransform:"capitalize"},value:s,children:t},s))})]})}),e.jsx("span",{children:e.jsxs(T,{size:"small",className:"select caps",children:[e.jsx(E,{id:"year-select-label",children:"Year"}),e.jsxs(C,{name:"year",labelId:"year-select-label",onChange:A,value:l.year,id:"year-select",label:"Year",children:[e.jsx(h,{value:2021,children:"2021"}),e.jsx(h,{value:2022,children:"2022"}),e.jsx(h,{value:2023,children:"2023"}),e.jsx(h,{value:2024,children:"2024"}),e.jsx(h,{value:2025,children:"2025"}),e.jsx(h,{value:2026,children:"2026"})]})]})}),e.jsxs("div",{className:"show-budget-toggle",children:[e.jsx("input",{type:"checkbox",id:"showBudget",checked:r,onChange:_}),e.jsx("label",{htmlFor:"showBudget",children:r?"Show Budget: ON":"Show Budget: OFF"})]})]}),e.jsxs("div",{className:"cards",children:[F.length===0&&e.jsx("div",{className:"empty",children:"No data for selected month"}),F.map(([t,s])=>{const a=Number((s==null?void 0:s.totalSum)||0),c=Number((s==null?void 0:s.budget)||0),b=j>0?Math.floor(a/j*100):0,x=a-c,y=x>0,O=b*3.6;return e.jsxs("div",{onClick:()=>U(t),className:"card",id:t,style:{cursor:"pointer"},children:[e.jsxs("div",{className:"data",children:[e.jsxs("div",{className:"amt",children:["₹",g(a)]}),e.jsx("div",{className:"day",children:s.ledger}),e.jsx("div",{className:`budget-info ${r?"visible":"hidden"}`,children:t==="Total"?e.jsxs(e.Fragment,{children:["Budget: ₹",g(c)," /",j>N?e.jsxs("span",{className:"over",children:[" + ",g(j-N)]}):e.jsxs("span",{className:"under",children:[" - ",g(N-j)]})]}):e.jsxs(e.Fragment,{children:["Budget: ₹",g(c)," /",y?e.jsxs("span",{className:"over",children:[" + ",g(Math.abs(x))]}):e.jsxs("span",{className:"under",children:[" - ",g(Math.abs(x))]})]})})]}),e.jsx("div",{className:"icon",children:e.jsx("div",{className:"cir",style:{background:`conic-gradient(#034972 ${O}deg, #afbbcb ${O}deg)`},children:e.jsxs("div",{className:"per",children:[b," %"]})})})]},t)})]})]})})};export{se as default};
