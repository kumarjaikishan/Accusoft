import{e as L,g as J,f as G,c as U,b as q,r as x,h as H,d as j,j as t,m as K,F as w,i as T,S as E}from"./index-B9NyKQW9.js";import{M as C}from"./MenuItem-C0bljZWw.js";var Y={exports:{}};(function(f,a){(function(u,l){f.exports=l()})(L,function(){return function(u,l){l.prototype.isSameOrAfter=function(d,i){return this.isSame(d,i)||this.isAfter(d,i)}}})})(Y);var P=Y.exports;const Q=J(P);var k={exports:{}};(function(f,a){(function(u,l){f.exports=l()})(L,function(){return function(u,l){l.prototype.isSameOrBefore=function(d,i){return this.isSame(d,i)||this.isBefore(d,i)}}})})(k);var W=k.exports;const X=J(W);j.extend(Q);j.extend(X);const te=()=>{var F,I;const f=G(),a=U(e=>e.userexplist||{}),u=q(),[l,d]=x.useState(!0),i=new Date,B=localStorage.getItem("month"),D=localStorage.getItem("year"),[n,z]=x.useState({date:`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`,month:B!==null?parseInt(B,10):i.getMonth(),year:D!==null?parseInt(D,10):i.getFullYear()}),_=()=>{let e=!l;d(e),localStorage.setItem("showbudget",JSON.stringify(e))};x.useEffect(()=>{let e=localStorage.getItem("showbudget");e&&d(!!JSON.parse(e))},[]),x.useEffect(()=>{f(H(!1)),localStorage.setItem("month",String(n.month)),localStorage.setItem("year",String(n.year))},[n.month,n.year,a]);const g=e=>typeof e=="number"?e.toLocaleString(void 0,{maximumFractionDigits:2}):e,m=x.useMemo(()=>{const e={};let s=0,o=0;(Array.isArray(a==null?void 0:a.ledgerlist)?a.ledgerlist:[]).forEach(r=>{const p=Number(r.budget||0);o+=p,e[r._id]={ledger:r.ledger,budget:p,totalSum:0}});const b=String(n.month+1).padStart(2,"0"),h=j(`${n.year}-${b}-01`),y=h.endOf("month");return(Array.isArray(a==null?void 0:a.explist)?a.explist:[]).forEach(r=>{const p=typeof(r==null?void 0:r.ledger)=="object"?r.ledger._id:r==null?void 0:r.ledger,$=Number(r.amount),O=j(r.date);p&&!isNaN($)&&O.isValid()&&O.isSameOrAfter(h)&&O.isSameOrBefore(y)&&e[p]&&(s+=$,e[p].totalSum+=$)}),e.Total={ledger:"Total",budget:o,totalSum:s},e},[a.ledgerlist,a.explist,n.month,n.year]),R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],A=e=>{const s=e.target.name;let o=e.target.value;(s==="month"||s==="year")&&(o=parseInt(o,10)),z(c=>({...c,[s]:o}))},V=e=>{if(e==="Total"){u(`/datanalysis/ledgerDetail/all?&ledgerName=All Ledger&month=${n.month}&year=${n.year}`);return}const s=((a==null?void 0:a.ledgerlist)||[]).find(o=>o._id===e);u(s?`/datanalysis/ledgerDetail/${e}?&ledgerName=${encodeURIComponent(s.ledger)}&month=${n.month}&year=${n.year}`:`/datanalysis/ledgerDetail/all?&ledgerName=All Ledger&month=${n.month}&year=${n.year}`)},M=x.useMemo(()=>{const e=Object.entries(m||{}),s=e.filter(([c])=>c!=="Total"),o=e.find(([c])=>c==="Total");return o?[...s,o]:s},[m]),S=((F=m==null?void 0:m.Total)==null?void 0:F.totalSum)||0,N=((I=m==null?void 0:m.Total)==null?void 0:I.budget)||0;return t.jsx(t.Fragment,{children:t.jsxs(K.div,{initial:{opacity:0,x:"100%"},animate:{opacity:1,x:0},exit:{opacity:0,x:"-100%"},transition:{duration:.2,ease:"easeInOut"},className:"datanalysis",children:[t.jsxs("div",{className:"cont",children:[t.jsx("span",{children:t.jsxs(w,{size:"small",className:" select caps",children:[t.jsx(T,{id:"month-select-label",children:"Month"}),t.jsx(E,{name:"month",size:"small",labelId:"month-select-label",onChange:A,value:n.month,id:"month-select",label:"Month",children:R.map((e,s)=>t.jsx(C,{sx:{textTransform:"capitalize"},value:s,children:e},s))})]})}),t.jsx("span",{children:t.jsxs(w,{size:"small",className:"select caps",children:[t.jsx(T,{id:"year-select-label",children:"Year"}),t.jsx(E,{name:"year",labelId:"year-select-label",onChange:A,value:n.year,id:"year-select",label:"Year",children:[2026,2025,2024,2023,2022,2021].map((e,s)=>t.jsx(C,{value:e,children:e},e))})]})}),t.jsxs("div",{className:"show-budget-toggle",children:[t.jsx("input",{type:"checkbox",id:"showBudget",checked:l,onChange:_}),t.jsx("label",{htmlFor:"showBudget",children:l?"Show Budget: ON":"Show Budget: OFF"})]})]}),t.jsxs("div",{className:"cards",children:[M.length===0&&t.jsx("div",{className:"empty",children:"No data for selected month"}),M.map(([e,s])=>{const o=Number((s==null?void 0:s.totalSum)||0),c=Number((s==null?void 0:s.budget)||0),b=S>0?Math.floor(o/S*100):0,h=o-c,y=h>0,v=b*3.6;return t.jsxs("div",{onClick:()=>V(e),className:"card",id:e,style:{cursor:"pointer"},children:[t.jsxs("div",{className:"data",children:[t.jsxs("div",{className:"amt",children:["₹",g(o)]}),t.jsx("div",{className:"day",children:s.ledger}),t.jsx("div",{className:`budget-info ${l?"visible":"hidden"}`,children:e==="Total"?t.jsxs(t.Fragment,{children:["Budget: ₹",g(c)," /",S>N?t.jsxs("span",{className:"over",children:[" + ",g(S-N)]}):t.jsxs("span",{className:"under",children:[" - ",g(N-S)]})]}):t.jsxs(t.Fragment,{children:["Budget: ₹",g(c)," /",y?t.jsxs("span",{className:"over",children:[" + ",g(Math.abs(h))]}):t.jsxs("span",{className:"under",children:[" - ",g(Math.abs(h))]})]})})]}),t.jsx("div",{className:"icon",children:t.jsx("div",{className:"cir",style:{background:`conic-gradient(#034972 ${v}deg, #afbbcb ${v}deg)`},children:t.jsxs("div",{className:"per",children:[b," %"]})})})]},e)})]})]})})};export{te as default};
