import{c as C,g as k,u as G,a as U,b as q,r as y,s as H,d as b,j as e,m as K,F as E,I as F,S as L,M as f}from"./index-IBXteg8z.js";var w={exports:{}};(function(S,n){(function(m,i){S.exports=i()})(C,function(){return function(m,i){i.prototype.isSameOrAfter=function(u,c){return this.isSame(u,c)||this.isAfter(u,c)}}})})(w);var P=w.exports;const Q=k(P);var Y={exports:{}};(function(S,n){(function(m,i){S.exports=i()})(C,function(){return function(m,i){i.prototype.isSameOrBefore=function(u,c){return this.isSame(u,c)||this.isBefore(u,c)}}})})(Y);var X=Y.exports;const Z=k(X);b.extend(Q);b.extend(Z);const te=()=>{var I,z;const S=G(),n=U(t=>t.userexplist||{}),m=q(),[i,u]=y.useState(!0),c=new Date,A=localStorage.getItem("month"),T=localStorage.getItem("year"),[o,W]=y.useState({date:`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`,month:A!==null?parseInt(A,10):c.getMonth(),year:T!==null?parseInt(T,10):c.getFullYear()}),[d,J]=y.useState({});y.useEffect(()=>{R(),S(H(!1)),localStorage.setItem("month",String(o.month)),localStorage.setItem("year",String(o.year))},[o.month,o.year,n]);const g=t=>typeof t=="number"?t.toLocaleString(void 0,{maximumFractionDigits:2}):t,R=()=>{const t={};let s=0,a=0;(Array.isArray(n==null?void 0:n.ledgerlist)?n.ledgerlist:[]).forEach(r=>{const x=Number(r.budget||0)||0;a+=x,t[r._id]={ledger:r.ledger,budget:x,totalSum:0}});const h=String(parseInt(o.month,10)+1).padStart(2,"0"),p=b(`${o.year}-${h}-01`),N=p.endOf("month");(Array.isArray(n==null?void 0:n.explist)?n.explist:[]).forEach(r=>{const x=r!=null&&r.ledger&&typeof r.ledger=="object"?r.ledger._id:(r==null?void 0:r.ledger)||null,D=parseFloat(r.amount),O=b(r.date);x&&!isNaN(D)&&O.isValid()&&O.isSameOrAfter(p)&&O.isSameOrBefore(N)&&t[x]&&(s+=D,t[x].totalSum+=D)}),t.Total={ledger:"Total",budget:a,totalSum:s},J(t)},_=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],M=t=>{const s=t.target.name;let a=t.target.value;(s==="month"||s==="year")&&(a=parseInt(a,10)),W(l=>({...l,[s]:a}))},V=t=>{if(t==="Total"){m(`/datanalysis/ledgerDetail/all?&ledgerName=All Ledger&month=${o.month}&year=${o.year}`);return}const s=((n==null?void 0:n.ledgerlist)||[]).find(a=>a._id===t);m(s?`/datanalysis/ledgerDetail/${t}?&ledgerName=${encodeURIComponent(s.ledger)}&month=${o.month}&year=${o.year}`:`/datanalysis/ledgerDetail/all?&ledgerName=All Ledger&month=${o.month}&year=${o.year}`)},B=y.useMemo(()=>{const t=Object.entries(d||{}),s=t.filter(([l])=>l!=="Total"),a=t.find(([l])=>l==="Total");return s.sort(([,l],[,h])=>h.totalSum-l.totalSum),a?[...s,a]:s},[d]),j=((I=d==null?void 0:d.Total)==null?void 0:I.totalSum)||0,v=((z=d==null?void 0:d.Total)==null?void 0:z.budget)||0;return e.jsx(e.Fragment,{children:e.jsxs(K.div,{initial:{opacity:0,x:"100%"},animate:{opacity:1,x:0},exit:{opacity:0,x:"-100%"},transition:{duration:.2,ease:"easeInOut"},className:"datanalysis",children:[e.jsxs("div",{className:"cont",children:[e.jsx("span",{children:e.jsxs(E,{size:"small",className:" select caps",children:[e.jsx(F,{id:"month-select-label",children:"Month"}),e.jsx(L,{name:"month",labelId:"month-select-label",onChange:M,value:o.month,id:"month-select",label:"Month",children:_.map((t,s)=>e.jsx(f,{sx:{textTransform:"capitalize"},value:s,children:t},s))})]})}),e.jsx("span",{children:e.jsxs(E,{size:"small",className:"select caps",children:[e.jsx(F,{id:"year-select-label",children:"Year"}),e.jsxs(L,{name:"year",labelId:"year-select-label",onChange:M,value:o.year,id:"year-select",label:"Year",children:[e.jsx(f,{value:2021,children:"2021"}),e.jsx(f,{value:2022,children:"2022"}),e.jsx(f,{value:2023,children:"2023"}),e.jsx(f,{value:2024,children:"2024"}),e.jsx(f,{value:2025,children:"2025"})]})]})}),e.jsx("span",{style:{marginLeft:12},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:i,onChange:t=>u(t.target.checked),style:{marginRight:6}}),"Show Budget"]})})]}),e.jsxs("div",{className:"cards",children:[B.length===0&&e.jsx("div",{className:"empty",children:"No data for selected month"}),B.map(([t,s])=>{const a=Number((s==null?void 0:s.totalSum)||0),l=Number((s==null?void 0:s.budget)||0),h=j>0?Math.floor(a/j*100):0,p=a-l,N=p>0,$=h*3.6;return e.jsxs("div",{onClick:()=>V(t),className:"card",id:t,style:{cursor:"pointer"},children:[e.jsxs("div",{className:"data",children:[e.jsx("div",{className:"amt",children:g(a)}),e.jsx("div",{className:"day",children:s.ledger}),i&&t!=="Total"&&e.jsxs("div",{className:"budget-info",style:{fontSize:"12px",marginTop:6},children:["Budget: ",g(l)," /",N?e.jsxs("span",{style:{color:"red",fontSize:"12px",fontWeight:500},children:[" + ",g(Math.abs(p))]}):e.jsxs("span",{style:{color:"green",fontSize:"12px",fontWeight:500},children:[" - ",g(Math.abs(p))]})]}),i&&t==="Total"&&e.jsxs("div",{className:"budget-info",style:{fontSize:"12px",marginTop:6},children:["Budget: ",g(l)," /",j>v?e.jsxs("span",{style:{color:"red",fontSize:"12px",fontWeight:500},children:[" + ",g(j-v)]}):e.jsxs("span",{style:{color:"green",fontSize:"12px",fontWeight:500},children:[" - ",g(v-j)]})]})]}),e.jsx("div",{className:"icon",children:e.jsx("div",{className:"cir",style:{background:`conic-gradient(#034972 ${$}deg, #afbbcb ${$}deg)`},children:e.jsxs("div",{className:"per",children:[h," %"]})})})]},t)})]})]})})};export{te as default};
