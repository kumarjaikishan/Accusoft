import{a as M,u as I,j as e,F as J,I as K,S as G,M as Q,L as V,A as H,D as W,T as E,s as x,h as f,Q as m,r as i,P as X,g as q}from"./index-fd811c46.js";const Z=({inp:l,modal:d,setmodal:y,handler:o,setinp:b})=>{const S=M(s=>s.userexplist),k=I(),C=async()=>{const s=localStorage.getItem("token");k(x(!0));let{_id:c,ledger:w,date:h,amount:u,narration:N}=l;h=f(h).format("YYYY-MM-DD");try{const p=await fetch("/api/adminupdateexp",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({_id:c,ledger:w,date:h,amount:u,narration:N})}),j=await p.json();console.log(j),p.ok?(m.success("Data updated Successfully",{autoClose:1300}),y(!1),k(x(!1))):(m.warn("error occurred",{autoClose:1300}),console.log(j))}catch(p){m.warn("Sopmething went wrong",{autoClose:1300}),console.log(p)}};document.querySelector(".modal");const D=s=>{let c=f(s);b({...l,date:c})};return e.jsx("div",{className:"modal",style:{display:d?"block":"none"},children:e.jsxs("div",{className:"box",children:[e.jsx("h1",{children:"Edit Detail"}),e.jsxs("span",{className:"wrapper",children:[e.jsxs(J,{className:"caps",sx:{width:"90%",mt:2,mb:2},children:[e.jsx(K,{id:"demo-simple-select-label",children:"Ledger"}),e.jsx(G,{name:"ledger",labelId:"demo-simple-select-label",onChange:s=>o(s,"ledger"),value:l.ledger,id:"demo-simple-select",label:"Ledger",children:S.ledgerlist.map((s,c)=>e.jsx(Q,{className:"caps",value:s._id,children:s.ledger},c))})]}),e.jsx(V,{onChange:s=>o(s,"date"),dateAdapter:H,children:e.jsx(W,{label:"Date",value:l.date,onChange:s=>D(s),sx:{width:"90%",mt:2,mb:2},format:"DD-MM-YYYY"})}),e.jsx(E,{sx:{width:"90%",mt:2,mb:2},id:"outlined-basic",label:"Amount",name:"amount",onKeyPress:s=>{/[0-9]/.test(s.key)||s.preventDefault()},type:"tel",value:l.amount,onChange:s=>o(s,"amount"),variant:"outlined"}),e.jsx(E,{multiline:!0,rows:2,sx:{width:"90%",mt:2,mb:2},id:"outlined-basic",label:"Narration",name:"narration",value:l.narration,type:"text",onChange:s=>o(s,"narration"),variant:"outlined"}),e.jsxs("div",{className:"btn",children:[e.jsx("button",{onClick:C,children:"submit"}),e.jsx("button",{onClick:()=>y(!1),children:"Cancel"})]})]})]})})},ae=()=>{const l=I();M(t=>t.userexplist);const[d,y]=i.useState([]);i.useEffect(()=>{b()},[]);let o=[];const b=async()=>{const t=localStorage.getItem("token");l(x(!0));try{const a=await fetch("/api/adminexp",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),n=await a.json();console.log("whole",n),a.ok&&(y(n.explist),l(x(!1)))}catch(a){console.log(a)}},S=new Date,[k,C]=i.useState("");i.useState(!1),S.getMonth()+1,S.getUTCDate();const D={_id:"",ledger:"",date:f(),amount:"",narration:""},[s,c]=i.useState(D),[w,h]=i.useState(1),[u,N]=i.useState(10),[p,j]=i.useState(!1),L=(t,a)=>{c({...s,[a]:t.target.value})},P=async t=>{c({_id:t._id,ledger:t.ledger._id,date:f(t.date),amount:t.amount,narration:t.narration}),j(!0)},_=async t=>{o=[],o.push(t),T(o)},F=async()=>{o=[],document.querySelectorAll("#tablecontent input:checked").forEach(a=>{o.push(a.id)}),T(o)},T=async t=>{if(t.length<1)return m.warn("Kindly Select Atlest 1 Entry",{autoClose:1700});const a=localStorage.getItem("token");q({title:"Are you sure?",text:"Once deleted, you will not be able to recover this Data!",icon:"warning",buttons:!0,dangerMode:!0}).then(async n=>{if(n){l(x(!0));try{const r=await fetch("/api/deletemanyexp",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({id:t})}),ee=await r.json();if(r.ok){m.success("Deleted Successfully",{autoClose:1300}),l(x(!1)),b();const z=document.querySelectorAll("#tablecontent input:checked"),te=document.querySelectorAll("#tablecontent tr");z.forEach(B=>{B.checked=!1}),A()}else m.warn("Something went wrong",{autoClose:1800})}catch(r){console.log(r)}}else q("Your data is safe!")})},R=()=>{const t=document.querySelector("#allcheck"),a=document.querySelectorAll("#tablecontent input");if(t.checked==!0)for(let n=0;n<a.length;n++)a[n].checked=!0;else for(let n=0;n<a.length;n++)a[n].checked=!1;A()},U=t=>{N(t.target.value),h(1)},$=t=>{h(t)},O=t=>{C(t.target.value)},A=()=>{const t=document.querySelectorAll("#tablecontent input");document.querySelectorAll("#tablecontent tr");for(let n=0;n<t.length;n++){var a=t[n].parentNode.parentNode;t[n].checked?(a.style.background="rgb(16 135 129)",a.style.color="white"):(a.style.background="transparent",a.style.color="black")}};let g=w*u;const v=g-u,Y=d.slice(v,g);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"adminexp",children:[e.jsxs("div",{className:"head",children:[e.jsx("span",{children:"All User Expense List"}),e.jsxs("span",{children:["Record :  ",e.jsxs("select",{name:"",id:"",value:u,onChange:U,children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"}),e.jsx("option",{value:"500",children:"500"})]})]}),e.jsx("span",{children:e.jsx("input",{type:"text",onChange:O,value:k,placeholder:"Type to search..."})})]}),e.jsx("div",{className:"table",children:e.jsxs("table",{cellSpacing:"15",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.no"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Ledger"}),e.jsx("th",{children:"Amt."}),e.jsx("th",{children:"Narration"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Actions"}),e.jsx("th",{children:e.jsx("input",{type:"checkbox",onClick:R,id:"allcheck"})})]})}),e.jsx("tbody",{id:"tablecontent",children:Y&&Y.map((t,a)=>{let n=new Date(t.date),r=n.getUTCDate();return r<10&&(r="0"+n.getUTCDate()),r+""+n.toLocaleString("default",{month:"short"})+n.getFullYear().toString().substr(-2),e.jsxs("tr",{children:[e.jsx("td",{children:v+a+1}),e.jsx("td",{className:"caps",children:t.userid.name}),e.jsx("td",{className:"caps",children:t.ledger.ledger}),e.jsx("td",{children:t.amount}),e.jsx("td",{children:t.narration}),e.jsxs("td",{children:[" ",f(t.date).format("DD MMM, YYYY")]}),e.jsxs("td",{children:[e.jsx("i",{title:"Edit",onClick:()=>P(t),className:"fa fa-pencil-square-o","aria-hidden":"true"}),e.jsx("i",{title:"Delete",onClick:()=>_(t._id),className:"fa fa-trash-o","aria-hidden":"true"})]}),e.jsx("td",{children:e.jsx("input",{type:"checkbox",onClick:A,id:t._id})})]},a)})}),e.jsx("tfoot",{children:e.jsxs("tr",{id:"foot",children:[e.jsx("th",{colSpan:"2"}),e.jsx("th",{colSpan:"1",children:"Total"}),e.jsx("th",{}),e.jsx("th",{colSpan:"2"}),e.jsx("th",{colSpan:"1",id:"alldelete",title:"Delete",children:e.jsx("i",{onClick:F,className:"fa fa-trash","aria-hidden":"true"})}),e.jsx("th",{colSpan:"1"})]})})]})}),e.jsxs("div",{className:"foot",children:[e.jsxs("span",{children:["Showing Result From ",v+1," To ",g>=d.length?g=d.length:g," of  ",d.length," Results"]}),e.jsxs("span",{children:["Pages :",e.jsx(X,{currentpage:w,changepageno:$,totalpost:d.length,postperpage:u})]})]}),e.jsx(Z,{handler:L,inp:s,setinp:c,modal:p,setmodal:j})]})})};export{ae as default};
