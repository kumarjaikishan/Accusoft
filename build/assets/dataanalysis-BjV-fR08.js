import{c as C,g as L,u as U,a as q,b as H,r as f,s as K,d as y,j as t,m as P,F,I as z,S as E,M as S}from"./index-D0tV8h5X.js";var J={exports:{}};(function(j,o){(function(g,r){j.exports=r()})(C,function(){return function(g,r){r.prototype.isSameOrAfter=function(d,c){return this.isSame(d,c)||this.isAfter(d,c)}}})})(J);var Q=J.exports;const X=L(Q);var Y={exports:{}};(function(j,o){(function(g,r){j.exports=r()})(C,function(){return function(g,r){r.prototype.isSameOrBefore=function(d,c){return this.isSame(d,c)||this.isBefore(d,c)}}})})(Y);var Z=Y.exports;const ee=L(Z);y.extend(X);y.extend(ee);const se=()=>{var M,w;const j=U(),o=q(e=>e.userexplist||{}),g=H(),[r,d]=f.useState(!0),c=new Date,D=localStorage.getItem("month"),T=localStorage.getItem("year"),[n,k]=f.useState({date:`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`,month:D!==null?parseInt(D,10):c.getMonth(),year:T!==null?parseInt(T,10):c.getFullYear()}),W=()=>{let e=!r;d(e),localStorage.setItem("showbudget",JSON.stringify(e))};f.useEffect(()=>{let e=localStorage.getItem("showbudget");e&&d(!!JSON.parse(e)),console.log(e),console.log(e)},[]);const[m,_]=f.useState({});f.useEffect(()=>{R(),j(K(!1)),localStorage.setItem("month",String(n.month)),localStorage.setItem("year",String(n.year))},[n.month,n.year,o]);const u=e=>typeof e=="number"?e.toLocaleString(void 0,{maximumFractionDigits:2}):e,R=()=>{const e={};let s=0,a=0;(Array.isArray(o==null?void 0:o.ledgerlist)?o.ledgerlist:[]).forEach(l=>{const x=Number(l.budget||0)||0;a+=x,e[l._id]={ledger:l.ledger,budget:x,totalSum:0}});const h=String(parseInt(n.month,10)+1).padStart(2,"0"),p=y(`${n.year}-${h}-01`),N=p.endOf("month");(Array.isArray(o==null?void 0:o.explist)?o.explist:[]).forEach(l=>{const x=l!=null&&l.ledger&&typeof l.ledger=="object"?l.ledger._id:(l==null?void 0:l.ledger)||null,B=parseFloat(l.amount),$=y(l.date);x&&!isNaN(B)&&$.isValid()&&$.isSameOrAfter(p)&&$.isSameOrBefore(N)&&e[x]&&(s+=B,e[x].totalSum+=B)}),e.Total={ledger:"Total",budget:a,totalSum:s},_(e)},V=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],A=e=>{const s=e.target.name;let a=e.target.value;(s==="month"||s==="year")&&(a=parseInt(a,10)),k(i=>({...i,[s]:a}))},G=e=>{if(e==="Total"){g(`/datanalysis/ledgerDetail/all?&ledgerName=All Ledger&month=${n.month}&year=${n.year}`);return}const s=((o==null?void 0:o.ledgerlist)||[]).find(a=>a._id===e);g(s?`/datanalysis/ledgerDetail/${e}?&ledgerName=${encodeURIComponent(s.ledger)}&month=${n.month}&year=${n.year}`:`/datanalysis/ledgerDetail/all?&ledgerName=All Ledger&month=${n.month}&year=${n.year}`)},I=f.useMemo(()=>{const e=Object.entries(m||{}),s=e.filter(([i])=>i!=="Total"),a=e.find(([i])=>i==="Total");return s.sort(([,i],[,h])=>h.totalSum-i.totalSum),a?[...s,a]:s},[m]),b=((M=m==null?void 0:m.Total)==null?void 0:M.totalSum)||0,v=((w=m==null?void 0:m.Total)==null?void 0:w.budget)||0;return t.jsx(t.Fragment,{children:t.jsxs(P.div,{initial:{opacity:0,x:"100%"},animate:{opacity:1,x:0},exit:{opacity:0,x:"-100%"},transition:{duration:.2,ease:"easeInOut"},className:"datanalysis",children:[t.jsxs("div",{className:"cont",children:[t.jsx("span",{children:t.jsxs(F,{size:"small",className:" select caps",children:[t.jsx(z,{id:"month-select-label",children:"Month"}),t.jsx(E,{name:"month",size:"small",labelId:"month-select-label",onChange:A,value:n.month,id:"month-select",label:"Month",children:V.map((e,s)=>t.jsx(S,{sx:{textTransform:"capitalize"},value:s,children:e},s))})]})}),t.jsx("span",{children:t.jsxs(F,{size:"small",className:"select caps",children:[t.jsx(z,{id:"year-select-label",children:"Year"}),t.jsxs(E,{name:"year",labelId:"year-select-label",onChange:A,value:n.year,id:"year-select",label:"Year",children:[t.jsx(S,{value:2021,children:"2021"}),t.jsx(S,{value:2022,children:"2022"}),t.jsx(S,{value:2023,children:"2023"}),t.jsx(S,{value:2024,children:"2024"}),t.jsx(S,{value:2025,children:"2025"})]})]})}),t.jsxs("div",{className:"show-budget-toggle",children:[t.jsx("input",{type:"checkbox",id:"showBudget",checked:r,onChange:W}),t.jsx("label",{htmlFor:"showBudget",children:r?"Show Budget: ON":"Show Budget: OFF"})]})]}),t.jsxs("div",{className:"cards",children:[I.length===0&&t.jsx("div",{className:"empty",children:"No data for selected month"}),I.map(([e,s])=>{const a=Number((s==null?void 0:s.totalSum)||0),i=Number((s==null?void 0:s.budget)||0),h=b>0?Math.floor(a/b*100):0,p=a-i,N=p>0,O=h*3.6;return t.jsxs("div",{onClick:()=>G(e),className:"card",id:e,style:{cursor:"pointer"},children:[t.jsxs("div",{className:"data",children:[t.jsxs("div",{className:"amt",children:["₹",u(a)]}),t.jsx("div",{className:"day",children:s.ledger}),r&&e!=="Total"&&t.jsxs("div",{className:"budget-info",style:{fontSize:"12px",marginTop:6},children:["Budget: ₹",u(i)," /",N?t.jsxs("span",{style:{color:"red",fontSize:"12px",fontWeight:500},children:[" + ",u(Math.abs(p))]}):t.jsxs("span",{style:{color:"green",fontSize:"12px",fontWeight:500},children:[" - ",u(Math.abs(p))]})]}),r&&e==="Total"&&t.jsxs("div",{className:"budget-info",style:{fontSize:"12px",marginTop:6},children:["Budget: ",u(i)," /",b>v?t.jsxs("span",{style:{color:"red",fontSize:"12px",fontWeight:500},children:[" + ",u(b-v)]}):t.jsxs("span",{style:{color:"green",fontSize:"12px",fontWeight:500},children:[" - ",u(v-b)]})]})]}),t.jsx("div",{className:"icon",children:t.jsx("div",{className:"cir",style:{background:`conic-gradient(#034972 ${O}deg, #afbbcb ${O}deg)`},children:t.jsxs("div",{className:"per",children:[h," %"]})})})]},e)})]})]})})};export{se as default};
